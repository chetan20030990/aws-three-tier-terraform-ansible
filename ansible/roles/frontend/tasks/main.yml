# =============================================================================
# FRONTEND ROLE - tasks/main.yml
# =============================================================================
# This role deploys Nginx as the frontend web server
# Tasks:
# 1. Install Nginx
# 2. Deploy static HTML frontend
# 3. Configure reverse proxy to Flask API
# 4. Start Nginx
# =============================================================================

---
- name: Install Nginx
  yum:
    name: nginx
    state: present
  become: yes

- name: Create web root directory
  file:
    path: /usr/share/nginx/html
    state: directory
    owner: nginx
    group: nginx
    mode: '0755'
  become: yes

- name: Deploy static frontend HTML
  template:
    src: index.html.j2
    dest: /usr/share/nginx/html/index.html
    owner: nginx
    group: nginx
    mode: '0644'
  become: yes

- name: Deploy Nginx configuration
  template:
    src: nginx.conf.j2
    dest: /etc/nginx/nginx.conf
    owner: root
    group: root
    mode: '0644'
  become: yes
  notify: Restart nginx

- name: Enable and start Nginx
  systemd:
    name: nginx
    enabled: yes
    state: started
  become: yes
